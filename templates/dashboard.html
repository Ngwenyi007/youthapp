{% extends 'base.html' %}
{% block content %}
<style>
:root {
  --bg: #f0f0f0;
  --text: #111;
  --card: #fff;
  --accent: #0077cc;
  --pinned: #ffeb3b;
}

body.dark-mode {
  --bg: #121212;
  --text: #f0f0f0;
  --card: #1f1f1f;
  --accent: #1e88e5;
  --pinned: #ffee58;
}

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* Header */
.top-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: var(--accent);
  color: white;
  position: sticky;
  top: 0;
  z-index: 1000;
}

.top-header h2 {
  font-size: 1.2rem;
  margin: 0;
}

.top-header button {
  background: transparent;
  border: none;
  font-size: 1.5rem;
  color: white;
}
.hidden {
  display: none;
}
.footer-buttons button.active {
  background-color: #444;
  color: white;
}
.footer-buttons {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f8f8f8;
  display: flex;
  justify-content: space-around;
  padding: 10px;
  border-top: 1px solid #ccc;
  z-index: 1000;
}

.footer-buttons button,
.footer-buttons a {
  padding: 10px;
  background: #ddd;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  text-decoration: none;
}

.footer-buttons .new-post-btn {
  background: #4CAF50;
  color: white;
}

.modal {
  position: fixed;
  bottom: 60px;
  left: 0;
  right: 0;
  background-color: white;
  padding: 20px;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
  z-index: 999;
}

.modal-content {
  background-color: #fff;
  margin: 20% auto;
  padding: 20px;
  border-radius: 12px;
  width: 80%;
  text-align: center;
}

.modal-content ul {
  list-style: none;
  padding: 0;
}

.modal-content ul li {
  margin: 10px 0;
}

.modal-content ul li a {
  text-decoration: none;
  font-size: 18px;
}

.close {
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
/* Search Section */
.search-section {
  padding: 1rem;
  background: var(--card);
}

.search-section input {
  width: 100%;
  padding: 0.7rem;
  font-size: 1rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #fff;
}

/* Posts */
main {
  padding: 1rem;
}

.post-card {
  background: var(--card);
  padding: 1rem;
  border-radius: 12px;
  margin-bottom: 1rem;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  position: relative;
}

.post-card.pinned {
  border-left: 5px solid var(--pinned);
}

.post-card h3 {
  margin-top: 0;
  font-size: 1.1rem;
}

.post-actions {
  margin-top: 0.5rem;
}

.post-actions a {
  margin-right: 1rem;
  text-decoration: none;
  color: var(--accent);
}

details summary {
  cursor: pointer;
  margin-top: 0.5rem;
}

.hidden {
  display: none;
}

.modal {
  position: fixed;
  bottom: 60px; /* juu kidogo ya footer */
  left: 0;
  right: 0;
  background-color: white;
  padding: 20px;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
  z-index: 999;
}

@keyframes slideDown {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.close-btn {
  float: right;
  font-size: 1.3rem;
  cursor: pointer;
}


.btn-level {
  background-color: #eef;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.3s;
}

.btn-level:hover {
  background-color: # ooffoo;
}

.btn-level.active {
  background-color: #3366ff;
  color: white;
  font-weight: bold;
  box-shadow: 0 0 5px #3366ff;
}
/* Bottom Navigation */
.bottom-nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: var(--card);
  display: flex;
  justify-content: space-around;
  padding: 0.6rem 0;
  border-top: 1px solid #ccc;
  z-index: 999;
}

.bottom-nav button,
.bottom-nav a {
  background: none;
  border: none;
  font-size: 0.9rem;
  color: var(--text);
  text-align: center;
}

.new-post-btn {
  background: var(--accent);
  color: white;
  border-radius: 20px;
  padding: 0.5rem 1rem;
  font-weight: bold;
  text-decoration: none;
}

/* Dark Mode Overrides */
body.dark-mode .search-section input {
  background: #2c2c2c;
  border: 1px solid #444;
  color: white;
}

body.dark-mode .modal-content {
  background: #2a2a2a;
}

body.dark-mode .bottom-nav {
  background: #1a1a1a;
  border-top: 1px solid #444;
}
</style>
    <!-- Header and Menu -->
    <header class="top-header">
      <h2>Welcome, {{ user.full_name }}</h2>
        <button onclick="toggleMenu()">‚ò∞</button>
    </header>
<!-- CHURCH LEVEL BUTTONS AT THE TOP -->
<!-- Sticky Top Filter: Church Level -->
<div style="position: sticky; top: 0; background: white; z-index: 1000; padding: 10px; border-bottom: 1px solid #ccc;">
  <form method="get" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
    <input type="hidden" name="filter_department" value="{{ filter_department }}">
    {% set level_style = "background-color: #007bff; color: white;" %}
    <button type="submit" name="filter_level" value="all"
      style="padding: 6px 10px; border-radius: 6px; border: none; {% if filter_level == 'all' %}{{ level_style }}{% endif %}">
      üåç All
    </button>
    <button type="submit" name="filter_level" value="local_church"
      style="padding: 6px 10px; border-radius: 6px; border: none; {% if filter_level == 'local_church' %}{{ level_style }}{% endif %}">
      ‚õ™ Local
    </button>
    <button type="submit" name="filter_level" value="parish"
      style="padding: 6px 10px; border-radius: 6px; border: none; {% if filter_level == 'parish' %}{{ level_style }}{% endif %}">
      üìç Parish
    </button>
    <button type="submit" name="filter_level" value="denary"
      style="padding: 6px 10px; border-radius: 6px; border: none; {% if filter_level == 'denary' %}{{ level_style }}{% endif %}">
      üó∫Ô∏è Denary
    </button>
    <button type="submit" name="filter_level" value="diocese"
      style="padding: 6px 10px; border-radius: 6px; border: none; {% if filter_level == 'diocese' %}{{ level_style }}{% endif %}">
      üèõÔ∏è Diocese
    </button>
  </form>
</div>
<!-- Your main content comes here: posts, members, etc. -->

<!-- Search & Filter -->
<section class="search-section" style="text-align: center; margin-bottom: 15px;">
  <input type="text" id="searchInput" placeholder="üîç Search posts..." onkeyup="filterPosts()" style="padding: 8px; width: 90%; max-width: 500px; border-radius: 5px; border: 1px solid #ccc;">
</section>

    <!-- Posts Section -->
    <main>
{% for post in posts %}
  <div class="post-card" style="border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #f9f9f9;">
    
    <!-- Post Meta -->
    <div style="font-size: 14px; color: #666;">
      üßë‚Äçüíº <strong>{{ post.poster_name }}</strong>
      from <strong>{{ post.level|capitalize }}</strong>
      <span style="font-style: italic;">{{ post.department|capitalize }} Dept</span>
      <span style="float:right;">üïí {{ time_since(post.timestamp) }}</span>
    </div>

    <!-- Post Title -->
    <h3 style="margin: 10px 0;">üìå {{ post.title }}</h3>

    <!-- Post Content -->
    <p style="margin: 10px 0;">{{ post.content }}</p>

    <!-- Post Actions -->
    <div style="display: flex; justify-content: space-between; font-size: 14px;">
      <a href="{{ url_for('view_post', post_id=post.id) }}">üí¨ View / Comment</a>
    </div>

  </div>
{% else %}
  <p style="text-align:center; color: gray;">No posts to display.</p>
{% endfor %}
    </main>

<footer class="bottom-nav">
 
<!-- Sticky Bottom Filter: Department -->

<!-- Department Buttons -->
<div style="position: sticky; bottom: 0; background: #fff; z-index: 1000; padding: 8px; border-top: 1px solid #ccc;">
  <form method="get" style="display: flex; justify-content: center; gap: 6px; flex-wrap: wrap;">
    <input type="hidden" name="filter_level" value="{{ filter_level }}">
    {% set active = "background-color:#28a745; color:white;" %}
    <button type="submit" name="filter_department" value="chaplaincy" style="border:none; padding:5px 10px; border-radius:5px; {% if filter_department == 'chaplaincy' %}{{ active }}{% endif %}">‚õ™ Chaplaincy</button>
    <button type="submit" name="filter_department" value="secretariat" style="border:none; padding:5px 10px; border-radius:5px; {% if filter_department == 'secretariat' %}{{ active }}{% endif %}">üñãÔ∏è Secretariat</button>
    <button type="submit" name="filter_department" value="treasury" style="border:none; padding:5px 10px; border-radius:5px; {% if filter_department == 'treasury' %}{{ active }}{% endif %}">üí∞ Treasury</button>
  </form>
</div>
    {% if 'chairman' in user.rank or
          'secretary' in user.rank or
          'chaplain' in user.rank or
          'organising secretary' in user.rank or
          'patron' in user.rank or
          'treasurer' in user.rank or
          'matron' in user.rank %}
      <a href="{{ url_for('create_post') }}" class="new-post-btn">‚ûï New Post</a>
    {% endif %}

    <button onclick="toggleMenu()">‚ò∞</button>
  </div>
{% if 'chairman' in user.rank.lower() %}
  <div class="my-4">
    <a href="{{ url_for('chairman_dashboard') }}" class="button is-warning is-fullwidth has-text-weight-bold">
      üìä Manage Members
    </a>
  </div>
{% endif %}
  <!-- Menu Modal -->
  <div id="menuModal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="toggleMenu()">&times;</span>
      <ul>
        <li><a href="{{ url_for('dashboard') }}">üè† Dashboard</a></li>
        <li><a href="{{ url_for('view_my_details') }}">üìù My Profile</a></li>
        <li><button onclick="toggleTheme()">üåì Light/Dark Mode</button></li>
        <li><button onclick="enableNotifications()">üîî Notifications</button></li>
        <li><a href="{{ url_for('logout') }}">üö™ Logout</a></li>
      </ul>
    </div>
  </div>
</footer>
<script>
  function toggleMenu() {
    document.getElementById('menuModal').classList.toggle('hidden');
  }

  function toggleTheme() {
    document.body.classList.toggle('dark-mode');
  }

  function enableNotifications() {
    alert("üîî Notifications enabled!");
  }

  function filterByDepartment(dept) {
    // Highlight active department
    document.querySelectorAll('.dept-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    // Filter post cards
    const cards = document.querySelectorAll(".post-card");
    cards.forEach(card => {
      card.style.display = card.innerText.includes(dept) ? "block" : "none";
    });

    // Funga menu ukifilter kupitia menu
    document.getElementById('menuModal').classList.add('hidden');
  }

  function filterPosts() {
    const term = document.getElementById("searchInput").value.toLowerCase();
    const posts = document.querySelectorAll(".post-card");
    posts.forEach(p => {
      p.style.display = p.innerText.toLowerCase().includes(term) ? "block" : "none";
    });
  }
</script>
{% endblock %}
